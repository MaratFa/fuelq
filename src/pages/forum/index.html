<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forum - FuelQuality</title>

    <!-- SEO Meta Tags -->
    <meta
      name="description"
      content="Join our community forum to discuss fuel quality and alternative energy sources."
    />
    <meta
      name="keywords"
      content="forum, fuels, quality, alternative energy, discussion, community"
    />
    <meta
      name="author"
      content="FuelQuality Policy, Government and Public Affairs"
    />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Forum - FuelQuality" />
    <meta
      property="og:description"
      content="Join our community forum to discuss fuel quality and alternative energy sources."
    />
    <meta
      property="og:url"
      content="https://www.fuelq.ru/pages/forum/index.html"
    />
    <meta property="og:site_name" content="fuelq.ru" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../../assets/images/favicon.png" />

    <!-- External CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../../assets/css/styles.css" />
  </head>

  <body>
    <!-- Header Component -->
    <div
      id="header-placeholder"
      data-component="src/components/header/header.html"
    ></div>

    <main>
      <section class="forum-hero">
        <div class="hero-content">
          <h1>Community Forum</h1>
          <p class="hero-subtitle">
            Connect with experts and enthusiasts in the fuel and energy industry
          </p>
          <p class="hero-description">
            Join our vibrant community to discuss the latest developments in
            fuel quality, alternative energy sources, and sustainable
            technologies. Share your knowledge, ask questions, and collaborate
            with professionals from around the world.
          </p>
          <div class="forum-stats">
            <div class="stat-item">
              <span class="stat-number">500+</span>
              <span class="stat-label">Active Members</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">1000+</span>
              <span class="stat-label">Discussion Topics</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">50+</span>
              <span class="stat-label">Expert Contributors</span>
            </div>
          </div>
        </div>
      </section>

      <section class="forum-content">
        <div class="forum-actions">
          <div class="action-left">
            <button id="new-thread-btn" class="btn-primary">
              <i class="fas fa-plus"></i> New Thread
            </button>
            <div class="filter-options">
              <select id="category-filter">
                <option value="all">All Categories</option>
                <option value="hydrogen">Hydrogen</option>
                <option value="biofuels">Biofuels</option>
                <option value="solar">Solar</option>
                <option value="wind">Wind</option>
                <option value="general">General Discussion</option>
              </select>
            </div>
          </div>
          <div class="action-right">
            <div class="search-box">
              <input
                type="text"
                id="search-input"
                placeholder="Search threads..."
              />
              <button id="search-btn"><i class="fas fa-search"></i></button>
            </div>
            <div class="view-options">
              <button id="grid-view" class="view-btn active">
                <i class="fas fa-th-large"></i>
              </button>
              <button id="list-view" class="view-btn">
                <i class="fas fa-list"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="thread-list-container">
          <div class="view-toggle">
            <div class="thread-grid" id="thread-grid">
              <!-- Threads will be dynamically loaded here -->
            </div>
            <ol class="thread-list" id="thread-list" style="display: none">
              <!-- Threads will be dynamically loaded here -->
            </ol>
          </div>
        </div>

        <div class="pagination">
          <button id="prev-page" disabled>
            <i class="fas fa-chevron-left"></i> Previous
          </button>
          <span id="page-info">Page 1 of 1</span>
          <button id="next-page" disabled>
            Next <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </section>

      <!-- New Thread Modal -->
      <div id="new-thread-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Create New Thread</h3>
            <span class="close">&times;</span>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="thread-title">Title</label>
              <input
                type="text"
                id="thread-title"
                placeholder="Enter thread title"
              />
            </div>
            <div class="form-group">
              <label for="thread-content">Content</label>
              <textarea
                id="thread-content"
                placeholder="Write your message"
              ></textarea>
            </div>
            <div class="form-group">
              <label for="thread-author">Your Name</label>
              <input
                type="text"
                id="thread-author"
                placeholder="Enter your name"
              />
            </div>
          </div>
          <div class="modal-footer">
            <button id="cancel-thread">Cancel</button>
            <button id="create-thread" class="btn-primary">
              Create Thread
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer Component -->
    <div
      id="footer-placeholder"
      data-component="src/components/footer/footer.html"
    ></div>

    <!-- JavaScript -->
    <script src="../../assets/js/components.js"></script>
    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/data/forum-data.js"></script>
    <script src="../../components/forum/forum.js"></script>
    <script src="../../components/header/header.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // DOM elements
        const threadList = document.getElementById("thread-list");
        const threadGrid = document.getElementById("thread-grid");
        const searchInput = document.getElementById("search-input");
        const searchBtn = document.getElementById("search-btn");
        const prevPage = document.getElementById("prev-page");
        const nextPage = document.getElementById("next-page");
        const pageInfo = document.getElementById("page-info");

        // State
        let currentPage = 1;
        const threadsPerPage = 10;
        let filteredThreads = [...threads];
        let currentView = "grid"; // "grid" or "list"
        let currentCategory = "all";

        // Initialize the forum
        renderThreads();

        // Event listeners
        searchBtn.addEventListener("click", handleSearch);
        searchInput.addEventListener("keyup", function (e) {
          if (e.key === "Enter") handleSearch();
        });
        prevPage.addEventListener("click", () => changePage(-1));
        nextPage.addEventListener("click", () => changePage(1));

        // New event listeners
        document
          .getElementById("grid-view")
          .addEventListener("click", () => setView("grid"));
        document
          .getElementById("list-view")
          .addEventListener("click", () => setView("list"));
        document
          .getElementById("category-filter")
          .addEventListener("change", handleCategoryFilter);

        // Functions
        function renderThreads() {
          // Clear current content
          threadList.innerHTML = "";
          threadGrid.innerHTML = "";

          // Calculate pagination
          const totalPages = Math.ceil(filteredThreads.length / threadsPerPage);
          const startIndex = (currentPage - 1) * threadsPerPage;
          const endIndex = startIndex + threadsPerPage;
          const threadsToShow = filteredThreads.slice(startIndex, endIndex);

          // Update pagination controls
          prevPage.disabled = currentPage === 1;
          nextPage.disabled = currentPage === totalPages || totalPages === 0;
          pageInfo.textContent = `Page ${currentPage} of ${totalPages || 1}`;

          // Render threads based on current view
          if (currentView === "grid") {
            threadGrid.style.display = "grid";
            threadList.style.display = "none";

            threadsToShow.forEach((thread) => {
              const threadCard = document.createElement("div");
              threadCard.className = "thread-card";
              threadCard.innerHTML = `
                <div class="thread-header">
                  <h3 class="thread-title">
                    <a href="thread.html?id=${thread.id}">${thread.title}</a>
                  </h3>
                  <span class="thread-category">${thread.category || "general"}</span>
                </div>
                <div class="thread-meta">
                  <span class="thread-author">by ${thread.author}</span>
                  <span class="thread-date">${formatDate(thread.date)}</span>
                </div>
                <div class="thread-stats">
                  <span class="thread-comments">${thread.comments.length} comments</span>
                  <span class="thread-views">${thread.views || 0} views</span>
                </div>
              `;
              threadGrid.appendChild(threadCard);
            });
          } else {
            threadGrid.style.display = "none";
            threadList.style.display = "block";

            threadsToShow.forEach((thread) => {
              const threadItem = document.createElement("li");
              threadItem.className = "thread-item";
              threadItem.innerHTML = `
                <div class="thread-item-header">
                  <h3 class="thread-title">
                    <a href="thread.html?id=${thread.id}">${thread.title}</a>
                  </h3>
                  <span class="thread-category">${thread.category || "general"}</span>
                </div>
                <div class="thread-meta">
                  <span class="thread-author">by ${thread.author}</span>
                  <span class="thread-date">${formatDate(thread.date)}</span>
                  <span class="thread-comments">${thread.comments.length} comments</span>
                  <span class="thread-views">${thread.views || 0} views</span>
                </div>
              `;
              threadList.appendChild(threadItem);
            });
          }

          // Show message if no threads
          if (threadsToShow.length === 0) {
            const noThreadsMessage =
              '<div class="no-threads">No threads found. Be the first to create one!</div>';
            threadList.innerHTML = noThreadsMessage;
            threadGrid.innerHTML = noThreadsMessage;
          }
        }

        function handleSearch() {
          const searchTerm = searchInput.value.toLowerCase().trim();

          if (searchTerm === "") {
            filteredThreads = currentCategory === "all" 
              ? [...threads] 
              : threads.filter(thread => thread.category === currentCategory);
          } else {
            filteredThreads = threads.filter(thread => {
              const matchesSearch = thread.title.toLowerCase().includes(searchTerm) ||
                thread.content.toLowerCase().includes(searchTerm) ||
                thread.author.toLowerCase().includes(searchTerm);
              
              const matchesCategory = currentCategory === "all" || thread.category === currentCategory;
              
              return matchesSearch && matchesCategory;
            });
          }

          currentPage = 1;
          renderThreads();
        }

        function changePage(direction) {
          const totalPages = Math.ceil(filteredThreads.length / threadsPerPage);
          currentPage += direction;

          if (currentPage < 1) currentPage = 1;
          if (currentPage > totalPages) currentPage = totalPages;

          renderThreads();
          window.scrollTo(0, 0);
        }

        function setView(view) {
          currentView = view;

          // Update button states
          document
            .getElementById("grid-view")
            .classList.toggle("active", view === "grid");
          document
            .getElementById("list-view")
            .classList.toggle("active", view === "list");

          // Update display
          document.getElementById("thread-grid").style.display =
            view === "grid" ? "grid" : "none";
          document.getElementById("thread-list").style.display =
            view === "list" ? "block" : "none";
        }

        function handleCategoryFilter() {
          currentCategory = document.getElementById("category-filter").value;

          // Filter threads
          if (currentCategory === "all") {
            filteredThreads = [...threads];
          } else {
            filteredThreads = threads.filter(
              thread => thread.category === currentCategory
            );
          }

          // Reset to first page
          currentPage = 1;
          renderThreads();
        }

        // Utility function to format dates
        function formatDate(timestamp) {
          const date = new Date(timestamp);
          return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }
      });
    </script>
  </body>
</html>
