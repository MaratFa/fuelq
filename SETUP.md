# Инструкция по настройке постоянной работы сайта fuelq.ru

## Обзор

Этот документ содержит инструкции по настройке постоянной работы сайта fuelq.ru, чтобы он был всегда доступен для пользователей.

## Шаг 1: Установка и запуск сервера

1. Убедитесь, что на сервере установлен Node.js (версия 14 или выше)
2. Установите необходимые зависимости:
   ```
   npm install
   ```

## Шаг 2: Настройка базы данных

1. Убедитесь, что сервер MySQL запущен и доступен
2. Импортируйте схему базы данных из файла `database/schema.sql`
3. Проверьте параметры подключения в файле `.env`

## Шаг 3: Настройка постоянной работы сервера

### Вариант A: Запуск через пакетный файл (Windows)

1. Запустите файл `run-server.bat` для запуска сервера с автоматическим перезапуском
2. Для автоматического запуска при загрузке системы:
   - Нажмите Win+R, введите `shell:startup` и нажмите Enter
   - Создайте ярлык для файла `run-server.bat` в папке автозагрузки

### Вариант B: Использование PM2 (рекомендуется для продакшн)

1. Установите PM2 глобально:
   ```
   npm install -g pm2
   ```

2. Создайте файл экосистемы `ecosystem.config.js`:
   ```javascript
   module.exports = {
     apps: [{
       name: 'fuelq-server',
       script: 'server.js',
       instances: 'max',
       exec_mode: 'cluster',
       env: {
         NODE_ENV: 'production'
       },
       error_file: './logs/err.log',
       out_file: './logs/out.log',
       log_file: './logs/combined.log',
       time: true
     }]
   };
   ```

3. Запустите приложение с помощью PM2:
   ```
   pm2 start ecosystem.config.js
   ```

4. Настройте автоматический запуск PM2 при перезагрузке сервера:
   ```
   pm2 startup
   pm2 save
   ```

## Шаг 4: Настройка веб-сервера Apache

Файл `.htaccess` уже настроен для перенаправления запросов на Node.js сервер, работающий на порту 3000.

## Шаг 5: Мониторинг и обслуживание

1. Проверяйте логи сервера регулярно:
   - `server.log` - основной лог работы сервера
   - `server-error.log` - лог ошибок

2. Для проверки статуса сервера можно использовать:
   ```
   pm2 status
   ```

3. Для перезапуска сервера:
   ```
   pm2 restart fuelq-server
   ```

## Решение проблем

### Если сайт недоступен (ошибка 503)

1. Проверьте, запущен ли сервер Node.js:
   ```
   netstat -ano | findstr :3000
   ```

2. Проверьте логи ошибок в `server-error.log`

3. Перезапустите сервер:
   ```
   pm2 restart fuelq-server
   ```
   или
   ```
   node start-server.js
   ```

### Если проблемы с базой данных

1. Проверьте подключение к базе данных:
   ```
   mysql -u u3363187_fuelq_admin -p u3363187_fuelq
   ```

2. Проверьте, что база данных и таблицы существуют:
   ```
   USE u3363187_fuelq;
   SHOW TABLES;
   ```

## Дополнительные рекомендации

1. Настройте регулярное резервное копирование базы данных
2. Настройте мониторинг работы сервера (например, с помощью UptimeRobot)
3. Регулярно обновляйте зависимости Node.js для безопасности
4. Рассмотрите возможность использования CDN для ускорения загрузки статических ресурсов
